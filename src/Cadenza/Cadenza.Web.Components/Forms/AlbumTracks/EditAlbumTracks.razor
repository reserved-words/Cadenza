@inherits EditAlbumTracksBase

@using Cadenza.Web.Components.Forms.Album

<AppDialog Cancel="OnCancel"
           CancelCaption="Cancel"
           Submit="OnSubmit"
           SubmitCaption="OK"
           FullHeight="false">
    <ChildContent>

        @if (EditableItems != null)
        {
            <MudTabs>
                @foreach (var disc in EditableItems)
                {
                    <MudTabPanel Text="@("Disc " + disc.DiscNo)">
                        <AppTable Items="@disc.Tracks">
                            <RowTemplate>
                                <MudTd Class="td-int-input">
                                    <MudNumericField MaxLength="3"
                                                     HideSpinButtons="true"
                                                     @bind-Value="context.TrackNo"
                                                     For="@(() => context.TrackNo)" />
                                </MudTd>
                                <MudTd>
                                    <MudTextField MaxLength="500"
                                                  @bind-Value="context.Title"
                                                  For="@(() => context.Title)" />
                                </MudTd>
                                <MudTd>
                                    <MudText Typo="@Typo.body1">@context.ArtistName</MudText>
                                    </MudTd>
                                    <MudTd Class="td-icon">
                                        <MudIcon Size="@Size.Small"
                                                 Icon="@Icons.Material.Filled.Info"
                                                 Title="@context.IdFromSource" />
                                    </MudTd>
                                    <MudTd Class="td-icon">
                                        <MudIconButton Size="@Size.Small"
                                                       Icon="@Icons.Material.Filled.Delete"
                                                       Title="Remove"
                                                       OnClick="@(() => OnRemoveTrack(context))">Remove</MudIconButton>
                                    </MudTd>
                                    <MudTd Class="td-icon">
                                        <MudMenu Icon="@Icons.Material.Filled.Album"
                                                 Size="@Size.Small"
                                                 title="Change disc">
                                            @foreach (var d in EditableItems)
                                            {
                                                if (d.DiscNo != disc.DiscNo)
                                                {
                                                    <MudMenuItem OnClick="@(() => MoveToDisc(context, d.DiscNo))">Disc @d.DiscNo</MudMenuItem>
                                                }
                                            }
                                        <MudMenuItem OnClick="@(() => MoveToDisc(context, null))">New Disc</MudMenuItem>
                                    </MudMenu>
                                </MudTd>
                            </RowTemplate>
                        </AppTable>
                    </MudTabPanel>
                }
            </MudTabs>
        }

    </ChildContent>
</AppDialog>
