@page "/"
@page "/player"
@using Cadenza.Web.Common.Interfaces.Startup

@if (IsInitialised)
{
    <MudTabs KeepPanelsAlive="true" Class="main-tabs" @ref="tabs">

        <MudHidden Breakpoint="Breakpoint.SmAndDown" Invert="true">

            <MudTabPanel Text="HOME" ID="@(Tab.Home)">
                <HomeTab />
            </MudTabPanel>
            <MudTabPanel Text="HISTORY" ID="@(Tab.History)">
                <HistoryTab />
            </MudTabPanel>
            <MudTabPanel Text="CURRENT TRACK" ID="@(Tab.CurrentTrack)">
                <CurrentlyPlayingTab />
            </MudTabPanel>
            <MudTabPanel Text="LIBRARY" ID="@(Tab.Library)">
                <LibraryTab />
            </MudTabPanel>
            <MudTabPanel Text="SEARCH" ID="@(Tab.Search)">
                <SearchTab />
            </MudTabPanel>

        </MudHidden>

        <MudHidden Breakpoint="Breakpoint.SmAndDown">

            <MudTabPanel Text="HISTORY" ID="@(Tab.History)">
                <HistoryTab />
            </MudTabPanel>
            <MudTabPanel Text="CURRENT TRACK" ID="@(Tab.CurrentTrack)">
                <CurrentlyPlayingTab />
            </MudTabPanel>
            <MudTabPanel Text="LIBRARY" ID="@(Tab.Library)">
                <LibraryTab />
            </MudTabPanel>
            <MudTabPanel Text="SEARCH" ID="@(Tab.Search)">
                <SearchTab />
            </MudTabPanel>

        </MudHidden>

    </MudTabs>
}

@code {

    [Inject]
    public NavigationManager NavigationManager { get; set; }

    [Inject]
    public IStartupConnectService ConnectService { get; set; }

    [Inject]
    public IProgressDialogService DialogService { get; set; }

    [Inject]
    public IMessenger Messenger { get; set; }

    MudTabs tabs;

    protected bool IsInitialised { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Messenger.Subscribe<ViewTabEventArgs>(OnViewTab);

        await OnStartup();
    }

    protected async Task OnStartup()
    {
        var success = await DialogService.Run(() => ConnectService.GetStartupTasks(), "Connecting Services", true);
        IsInitialised = success;
    }

    private Task OnViewTab(object sender, ViewTabEventArgs args)
    {
        tabs.ActivatePanel(args.Tab);
        return Task.CompletedTask;
    }
}