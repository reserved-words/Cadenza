
<MudCard Style="height: 100%; display: flex; flex-direction: column;">

    <MudCardContent Class="fixed-height-scroll pa-0" Style="flex-grow: 1;">

        <MudTabs KeepPanelsAlive="true" Class="main-tabs" @ref="tabs">

            <MudTabPanel Text="HOME" ID="@(Tab.Home)">
                <HomeTab />
            </MudTabPanel>
            <MudTabPanel Text="DASHBOARD" ID="@(Tab.Dashboard)">
                <DashboardTab />
            </MudTabPanel>
            <MudTabPanel Text="LIBRARY" ID="@(Tab.Library)">
                <LibraryTab />
            </MudTabPanel>
            <MudTabPanel Text="SETTINGS" ID="@(Tab.Settings)">
                <SettingsTab />
            </MudTabPanel>
            <MudTabPanel Text="EDIT" ID="@(Tab.Edit)">
                <EditTab />
            </MudTabPanel>

        </MudTabs>

    </MudCardContent>

    <MudCardActions Style="flex-grow: 0;">
@*         @foreach (var tab in _tabs)
        {
            <MudIconButton Icon="@tab.GetIcon()" Color="Color.Default" OnClick="@(() => View(tab))" />
        }
 *@        
        <MudIconButton Size="@Size.Large" Icon="@Tab.Home.GetIcon()" Color="Color.Default" OnClick="@(() => View(Tab.Home))" />
        <MudIconButton Size="@Size.Large" Icon="@Icons.Material.Filled.PlaylistPlay" Color="Color.Default" OnClick="@(() => {})" />
        <MudIconButton Size="@Size.Large" Icon="fas fa-chart-history" Color="Color.Default" OnClick="@(() => {})" />
        <MudIconButton Size="@Size.Large" Icon="fas fa-compact-disc" Color="Color.Default" OnClick="@(() => {})" />
        <MudIconButton Size="@Size.Large" Icon="@Tab.Library.GetIcon()" Color="Color.Default" OnClick="@(() => View(Tab.Library))" />
    </MudCardActions>

</MudCard>

@code {

    [Inject] public IDispatcher Dispatcher { get; set; }
    [Inject] public IState<ViewState> ViewState { get; set; }

    MudTabs tabs;

    private readonly List<Tab> _tabs = [Tab.Home, Tab.Dashboard, Tab.Library];

    protected override void OnInitialized()
    {
        ViewState.StateChanged += ViewState_StateChanged;
        base.OnInitialized();
    }

    private void View(Tab tab)
    {
        Dispatcher.Dispatch(new ViewTabRequest(tab));
    }

    private void ViewState_StateChanged(object sender, EventArgs args)
    {
        var switchToTab = ViewState.Value.CurrentTab == Tab.Default
            ? Tab.Home
            : ViewState.Value.CurrentTab;

        tabs.ActivatePanel(switchToTab);
    }
}