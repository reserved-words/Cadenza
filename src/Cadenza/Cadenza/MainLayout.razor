@using Cadenza.Web.Common.Interfaces.Startup
@inherits LayoutComponentBase

<MudThemeProvider IsDarkMode="@true" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1" Color="@Color.Dark" DisableGutters="@true">
        <MudButton StartIcon="@Icons.Material.Filled.History" Color="Color.Inherit" OnClick="@History" Class="mx-3">History</MudButton>
        <MudButton Color="Color.Inherit" OnClick="@CurrentTrack" Class="mx-3">
            <CurrentlyPlayingIcon Playing="@IsCurrentlyPlaying" Class="ml-0 mr-3" />
            Playing
        </MudButton>
        <MudButton StartIcon="@Icons.Material.Filled.LibraryBooks" Color="Color.Inherit" OnClick="@Library" Class="mx-3">Library</MudButton>
        <MudSpacer />
        <Search />
    </MudAppBar>
    <MudDrawer Open="@true" Elevation="2" Class="ma-0 pa-0 flex flex-column">
        <MudContainer Class="ma-0 pa-0 px-2 my-2 flex-grow-0">
            <CurrentlyPlayingHeader />
        </MudContainer>
        <MudContainer Class="ma-0 pa-0 px-2 mb-2 flex-grow-0">
            <Player />
        </MudContainer>
        <MudContainer Class="ma-0 pa-0 px-2 mb-2 flex-grow-1">
            <Shuffle />
        </MudContainer>
        <MudContainer Class="ma-0 pa-0 flex-grow-0">
            <Toolbar />
        </MudContainer>

    </MudDrawer>
    <MudMainContent>

        @Body

    </MudMainContent>
</MudLayout>

@code {
    protected override void OnInitialized()
    {
        Messenger.Subscribe<PlayStatusEventArgs>(OnPlayStatusChanged);
    }

    [Inject]
    public IMessenger Messenger { get; set; }

    protected bool IsCurrentlyPlaying { get; set; }

    private async Task History()
    {
        await Messenger.Send(this, new ViewTabEventArgs(Tab.History));
    }

    private async Task CurrentTrack()
    {
        await Messenger.Send(this, new ViewTabEventArgs(Tab.CurrentTrack));
    }

    private async Task Library()
    {
        await Messenger.Send(this, new ViewTabEventArgs(Tab.Library));
    }

    private Task OnPlayStatusChanged(object sender, PlayStatusEventArgs args)
    {
        IsCurrentlyPlaying = args.Status != PlayStatus.Stopped;
        StateHasChanged();
        return Task.CompletedTask;
    }
}
